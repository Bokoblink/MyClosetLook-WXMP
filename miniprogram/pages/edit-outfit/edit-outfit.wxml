<!-- pages/edit-outfit/edit-outfit.wxml -->
<view class="container">
  <!-- 表单主体 -->
  <view class="form-section">
    <view class="form-item">
      <text class="label required">穿搭名称</text>
      <input class="input" placeholder="给这套穿搭起个名字吧" value="{{name}}" bindinput="onInput" data-key="name"/>
    </view>
    
    <view class="form-item">
      <text class="label">季节</text>
      <view class="picker-container">
        <picker mode="selector" range="{{seasons}}" value="{{seasons.indexOf(season)}}" bindchange="onSeasonChange">
          <view class="picker-content {{season ? '' : 'placeholder-style'}}">{{season || '请选择季节'}}</view>
        </picker>
        <view wx:if="{{season}}" class="clear-btn" bindtap="clearPicker" data-key="season">×</view>
      </view>
    </view>

    <view class="form-item">
      <text class="label">穿搭图</text>
      <view class="upload-box" bindtap="chooseOutfitImage">
        <image wx:if="{{outfitImage}}" src="{{outfitImage}}" class="preview" mode="aspectFill"></image>
        <view wx:else class="upload-placeholder">+ 上传图片</view>
      </view>
      <view class="form-tip">不上传将默认使用第一件下裙或上衣的图片</view>
    </view>
  </view>

  <!-- 上衣区 -->
  <view class="category-section">
    <view class="category-header">
      <text class="title">上衣</text>
      <button class="add-btn" size="mini" bindtap="openSelector" data-category="上衣">+ 添加</button>
    </view>
    <view class="clothes-container">
      <view class="clothe-item" wx:for="{{selectedTops}}" wx:key="_id">
        <image src="{{item.imageUrl}}" class="clothe-thumb" mode="aspectFill"></image>
        <view class="remove-icon" bindtap="removeSelectedItem" data-id="{{item._id}}" data-category="上衣">×</view>
      </view>
      <view wx:if="{{selectedTops.length === 0}}" class="empty-tip">暂未选择上衣</view>
    </view>
  </view>

  <!-- 下裙区 -->
  <view class="category-section">
    <view class="category-header">
      <text class="title">下裙</text>
      <button class="add-btn" size="mini" bindtap="openSelector" data-category="下裙">+ 添加</button>
    </view>
    <view class="clothes-container">
      <view class="clothe-item" wx:for="{{selectedSkirts}}" wx:key="_id">
        <image src="{{item.imageUrl}}" class="clothe-thumb" mode="aspectFill"></image>
        <view class="remove-icon" bindtap="removeSelectedItem" data-id="{{item._id}}" data-category="下裙">×</view>
      </view>
      <view wx:if="{{selectedSkirts.length === 0}}" class="empty-tip">暂未选择下裙</view>
    </view>
  </view>

  <!-- 配饰区 -->
  <view class="category-section">
    <view class="category-header">
      <text class="title">配饰</text>
      <button class="add-btn" size="mini" bindtap="openSelector" data-category="配饰">+ 添加</button>
    </view>
    <view class="clothes-container">
      <view class="clothe-item" wx:for="{{selectedAccessories}}" wx:key="_id">
        <image src="{{item.imageUrl}}" class="clothe-thumb" mode="aspectFill"></image>
        <view class="remove-icon" bindtap="removeSelectedItem" data-id="{{item._id}}" data-category="配饰">×</view>
      </view>
      <view wx:if="{{selectedAccessories.length === 0}}" class="empty-tip">暂未选择配饰</view>
    </view>
  </view>

  <!-- 保存按钮 -->
  <view class="action-bar">
    <button class="save-btn" bindtap="updateOutfit">保存更新</button>
  </view>
</view>

<!-- 衣物选择全屏弹窗 -->
<view class="selector-popup" wx:if="{{isSelectorShow}}">
  <view class="selector-header">
    <view class="selector-title">选择{{currentCategory}}</view>
    <view class="close-btn" bindtap="closeSelector">完成</view>
  </view>

  <!-- 筛选区域 -->
  <view class="filter-section">
    <scroll-view scroll-x class="filter-scroll">
      <view 
        wx:for="{{filterOptions}}" 
        wx:key="*this"
        class="filter-item {{currentFilter === item ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-filter="{{item}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>

  <view class="selector-list-wrapper">
    <scroll-view scroll-y class="selector-list" bindscrolltolower="loadMoreSelectableClothes">
    <view 
      class="selector-item {{item.selected ? 'selected' : ''}}"
      wx:for="{{selectableClothes}}" 
      wx:key="_id"
      bindtap="toggleClothSelection"
      data-id="{{item._id}}"
    >
      <image src="{{item.imageUrl}}" class="selector-image" mode="aspectFill"></image>
      <text>{{item.name}}</text>
      <view class="checkbox {{item.selected ? 'checked' : ''}}"></view>
    </view>
    <view class="loading-tip" wx:if="{{loadingClothes}}">加载中...</view>
    <view class="empty-tip" wx:if="{{!loadingClothes && selectableClothes.length === 0}}">这个分类下没有衣物哦</view>
  </scroll-view>
  </view>
</view>
